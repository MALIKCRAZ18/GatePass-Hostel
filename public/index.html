<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatepass-Generator</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container container1">
        <h1 class="header-section">Hostel Leave Request Screen</h1>
        <div class="container2">
            <button class="request" id="req" onclick="myFunction1()">Leave Request</button>
            <button class="status" id="stat" onclick="myFunction2()">Leave Status</button>
            <button class="history" id="hist" onclick="myFunction3()">Leave History</button>
        </div>
        <div class="container3" style="display: none;">
            <form class="form-horizontal" action="http://localhost:5000/submit-leave" method="POST">
                <div class="form-group">
                    <label class="Leave control-label col-sm-2" for="Ltype">Leave Type</label>
                <select name="Ltype" id="Ltype">
                    <option value="select">-Select-</option>
                    <option value="sick">Sick</option>
                    <option value="emergency">Emergency</option>
                    <option value="medical">Medical advice</option>
                    <option value="od">On Duty</option>
                </select><br>
            </div>
            <div class="form-group">
                <label class="visit control-label col-sm-2" for="Visit">Visiting Place</label>
                <input type="text" name="Visit" id="Visit" required><br>
            </div>
            <div class="form-group">
                <label class="fromdate control-label col-sm-2" for="fdate">From Date</label>
                <input type="date" name="fdate" id="fdate" required><br>
            </div>
            <div class="form-group">
                <label class="timefrom control-label col-sm-2" for="tform">Time From</label>
                <input type="time" name="tform" id="tform" required><br>
            </div>
            <div class="form-group">
                <label class="todate control-label col-sm-2" for="tdate">To Date</label>
                <input type="date" name="tdate" id="tdate" required><br>
            </div>
            <div class="form-group">
                <label class="timeto control-label col-sm-2" for="tto">Time To</label>
                <input type="time" name="tto" id="tto" required><br>
            </div>
            <div class="form-group">
                <label class="reason control-label col-sm-2" for="reason">Reason</label>
                <textarea name="reason" id="reason" required></textarea><br>
            </div>
            <div class="col-sm-offset-1 col-sm-10" style="margin-bottom: 50px;">
                <button type="submit" class="btn btn-warning">Submit Leave Application</button>
              </div>

            </form>
        </div>
        <div class="container4" style="display: none;">
            <h1 class="hod">LEAVE DATA</h1>
            <p class="hod">Leave results</p>
            <table id="leaveTable" class="table table-bordered table-responsive">
    <thead>
        <tr class="hod">
            <th>ID</th>
            <th>Leave Type</th>
            <th>Visiting Place</th>
            <th>From Date</th>
            <th>From Time</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be inserted here -->
    </tbody>
    </table>
        </div>
    
    <div class="container5" style="display: none;">
        <table id="leaveHistory" class="table table-bordered table-responsive">
            <thead>
                <tr class="hod">
                    <th>ID</th>
                    <th>Leave Type</th>
                    <th>Visiting Place</th>
                    <th>From Date</th>
                    <th>From Time</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be inserted here -->
            </tbody>
            </table>
    </div>
</div>
    <script>
        function myFunction1() {
          
           document.querySelector('.container3').style.display = 'block';
           document.querySelector('.container4').style.display = 'none';
           document.querySelector('.container5').style.display = 'none';
        }
        function myFunction2() {
        
           document.querySelector(".container3").style.display = "none";
            document.querySelector(".container4").style.display = "block";
            document.querySelector(".container5").style.display = "none";
           async function fetchLeaveData() {
    try {
        loggedinreg = "REG123";
        const response = await fetch('http://localhost:5000/leave-status/');
        console.log("DONE")
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        console.log(data);
        const tableBody = document.querySelector('#leaveTable tbody');

        const row = document.createElement("tr");
        row.classList.add("hod");
        row.innerHTML = `
            <td>${data.id}</td>
            <td>${data.leave_type}</td>
            <td>${data.visiting_place}</td>
            <td>${data.reason}</td>
            <td>${new Date(data.from_date).toLocaleDateString()}</td>
            <td>${data.from_time}</td>
        `;

        tableBody.innerHTML = "";
        tableBody.appendChild(row); 
    } catch (error) {
        console.error('Error fetching leave data:', error);
    }
}
fetchLeaveData();
        }
        function myFunction3() {
            document.querySelector(".container3").style.display = "none";
            document.querySelector(".container4").style.display = "none";
            document.querySelector(".container5").style.display = "block";
            async function fetchLeaveData() {
                try {; 
                    const response = await fetch('http://localhost:5000/leave-history/');
                    if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let data = await response.json();
                console.log(data);
                const tableBody = document.querySelector('#leaveHistory tbody');
                tableBody.innerHTML = "";
    

// ðŸ“Œ Case 1: No data found
if (!data || Object.keys(data).length === 0) {
    tableBody.innerHTML = `<tr><td colspan="5">No data available</td></tr>`;
    return;
}

// ðŸ“Œ Case 2: Convert single object to an array
if (!Array.isArray(data)) {
    data = [data]; // Wrap in an array
}

// ðŸ“Œ Case 3: Loop through each record (Single or Multiple)
data.forEach(item => {
    const row = document.createElement("tr");
    row.classList.add("hod"); // Add class if needed

    row.innerHTML = `
        <td>${item.id}</td>
        <td>${item.leave_type}</td>
        <td>${item.visiting_place}</td>
        <td>${new Date(item.from_date).toLocaleDateString()}</td>
        <td>${item.from_time}</td>
    `;

    tableBody.appendChild(row);
});

        

            }
            catch (error) {
                console.error('Error fetching leave data:', error);
            }
        }
        fetchLeaveData();
    }
      </script>
</body>
</html>
